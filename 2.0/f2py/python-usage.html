
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using F2PY bindings in Python &#8212; NumPy v2.0 Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/numpy.css?v=f033eccb" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=db988ed8"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'f2py/python-usage';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://numpy.org/doc/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="F2PY and build systems" href="buildtools/index.html" />
    <link rel="prev" title="Signature file" href="signature-file.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Jun 16, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/numpylogo.svg" class="logo__image only-light" alt="NumPy v2.0 Manual - Home"/>
    <script>document.write(`<img src="../_static/numpylogo_dark.svg" class="logo__image only-dark" alt="NumPy v2.0 Manual - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../user/index.html">
    User Guide
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../building/index.html">
    Building from source
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../dev/index.html">
    Development
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../release.html">
    Release notes
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-external" href="https://numpy.org/numpy-tutorials/">
    Learn
  </a>
</li>

            <li class="nav-item dropdown pst-header-nav-item">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class="nav-item ">
  <a class="nav-link dropdown-item nav-external" href="https://numpy.org/neps">
    NEPs
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/numpy/numpy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="../user/index.html">
    User Guide
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../building/index.html">
    Building from source
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../dev/index.html">
    Development
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../release.html">
    Release notes
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-external" href="https://numpy.org/numpy-tutorials/">
    Learn
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-external" href="https://numpy.org/neps">
    NEPs
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/numpy/numpy" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user/whatisnumpy.html">What is NumPy?</a></li>
<li class="toctree-l1"><a class="reference external" href="https://numpy.org/install/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/quickstart.html">NumPy quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/absolute_beginners.html">NumPy: the absolute basics for beginners</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fundamentals and usage</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user/basics.html">NumPy fundamentals</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user/numpy-for-matlab-users.html">NumPy for MATLAB users</a></li>
<li class="toctree-l1"><a class="reference external" href="https://numpy.org/numpy-tutorials/features.html">NumPy tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/howtos_index.html">NumPy how-tos</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced usage and interoperability</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../user/c-info.html">Using NumPy C-API</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">F2PY user guide and reference manual</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="f2py-user.html">F2PY user guide</a></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="f2py-reference.html">F2PY reference manual</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="signature-file.html">Signature file</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Using F2PY bindings in Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildtools/index.html">F2PY and build systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced/use_cases.html">Advanced F2PY use cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced/boilerplating.html">Boilerplate reduction and templating</a></li>
<li class="toctree-l3"><a class="reference internal" href="f2py-testing.html">F2PY test suite</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="windows/index.html">F2PY and Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="buildtools/distutils-to-meson.html">1 Migrating to <code class="docutils literal notranslate"><span class="pre">meson</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/underthehood.html">Under-the-hood documentation for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/basics.interoperability.html">Interoperability with NumPy</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy_2_0_migration_guide.html">NumPy 2.0 migration guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">NumPy license</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">





<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user/index.html" class="nav-link">NumPy user guide</a></li>
    
    
    <li class="breadcrumb-item"><i class="fa-solid fa-ellipsis"></i></li>
    
    
    <li class="breadcrumb-item"><a href="f2py-reference.html" class="nav-link">F2PY reference manual</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Using F2PY...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="using-f2py-bindings-in-python">
<h1>Using F2PY bindings in Python<a class="headerlink" href="#using-f2py-bindings-in-python" title="Link to this heading">#</a></h1>
<p>In this page, you can find a full description and a few examples of common usage
patterns for F2PY with Python and different argument types. For more examples
and use cases, see <a class="reference internal" href="f2py-examples.html#f2py-examples"><span class="std std-ref">F2PY examples</span></a>.</p>
<section id="fortran-type-objects">
<h2>Fortran type objects<a class="headerlink" href="#fortran-type-objects" title="Link to this heading">#</a></h2>
<p>All wrappers for Fortran/C routines, common blocks, or Fortran 90 module data
generated by F2PY are exposed to Python as <code class="docutils literal notranslate"><span class="pre">fortran</span></code> type objects. Routine
wrappers are callable <code class="docutils literal notranslate"><span class="pre">fortran</span></code> type objects while wrappers to Fortran data
have attributes referring to data objects.</p>
<p>All <code class="docutils literal notranslate"><span class="pre">fortran</span></code> type objects have an attribute <code class="docutils literal notranslate"><span class="pre">_cpointer</span></code> that contains a
<a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.12)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a> referring to the C pointer of the corresponding Fortran/C function
or variable at the C level. Such <code class="docutils literal notranslate"><span class="pre">PyCapsule</span></code> objects can be used as callback
arguments for F2PY generated functions to bypass the Python C/API layer for
calling Python functions from Fortran or C. This can be useful when the
computational aspects of such functions are implemented in C or Fortran and
wrapped with F2PY (or any other tool capable of providing the <code class="docutils literal notranslate"><span class="pre">PyCapsule</span></code>
containing a function).</p>
<p>Consider a Fortran 77 file <code class="docutils literal notranslate"><span class="pre">`ftype.f</span></code>:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="n">FTYPE</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">N</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="kt">integer </span><span class="k">optional</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">13</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">A</span><span class="p">,</span><span class="n">X</span>
<span class="w">      </span><span class="k">COMMON</span><span class="w"> </span><span class="o">/</span><span class="k">DATA</span><span class="o">/</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">C</span><span class="w">     </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IN FOO: N=&quot;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="s2">&quot; A=&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="s2">&quot; X=[&quot;</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;]&quot;</span>
<span class="w">      </span><span class="k">END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="n">FTYPE</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and a wrapper built using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">ftype.f</span> <span class="pre">-m</span> <span class="pre">ftype</span></code>.</p>
<p>In Python, you can observe the types of <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code>, and how to access
individual objects of the wrapped Fortran code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ftype</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ftype</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">This module &#39;ftype&#39; is auto-generated with f2py (version:2).</span>
<span class="go">Functions:</span>
<span class="go">  foo(n=13)</span>
<span class="go">COMMON blocks:</span>
<span class="go">  /data/ a,x(3)</span>
<span class="go">.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">ftype</span><span class="o">.</span><span class="n">foo</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">ftype</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">(&lt;class &#39;fortran&#39;&gt;, &lt;class &#39;fortran&#39;&gt;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> IN FOO: N= 13 A=  0. X=[  0.  0.  0.]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> IN FOO: N= 13 A=  3. X=[  1.  2.  3.]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="go"> IN FOO: N= 24 A=  3. X=[  1.  45.  3.]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ftype</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([  1.,  45.,   3.], dtype=float32)</span>
</pre></div>
</div>
</section>
<section id="scalar-arguments">
<h2>Scalar arguments<a class="headerlink" href="#scalar-arguments" title="Link to this heading">#</a></h2>
<p>In general, a scalar argument for a F2PY generated wrapper function can be an
ordinary Python scalar (integer, float, complex number) as well as an arbitrary
sequence object (list, tuple, array, string) of scalars. In the latter case, the
first element of the sequence object is passed to the Fortran routine as a
scalar argument.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When type-casting is required and there is possible loss of information via
narrowing e.g. when type-casting float to integer or complex to float, F2PY
<em>does not</em> raise an exception.</p>
<ul>
<li><p>For complex to real type-casting only the real part of a complex number
is used.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">intent(inout)</span></code> scalar arguments are assumed to be array objects in
order to have <em>in situ</em> changes be effective. It is recommended to use
arrays with proper type but also other types work. <a class="reference internal" href="signature-file.html#f2py-attributes"><span class="std std-ref">Read more about
the intent attribute</span></a>.</p></li>
</ul>
</div>
<p>Consider the following Fortran 77 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="n">SCALAR</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
<span class="w">      </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="n">a</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="n">b</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;    A=&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="s2">&quot; B=&quot;</span><span class="p">,</span><span class="n">B</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;INCREMENT A AND B&quot;</span>
<span class="w">      </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="n">D0</span>
<span class="w">      </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="n">D0</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NEW A=&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="s2">&quot; B=&quot;</span><span class="p">,</span><span class="n">B</span>
<span class="w">      </span><span class="k">END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="k">FILE </span><span class="n">SCALAR</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">scalar</span> <span class="pre">scalar.f</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scalar</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">scalar</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">foo(a,b)</span>

<span class="go">Wrapper for ``foo``.</span>

<span class="go">Parameters</span>
<span class="go">----------</span>
<span class="go">a : input float</span>
<span class="go">b : in/output rank-0 array(float,&#39;d&#39;)</span>
<span class="go"> </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scalar</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>   
<span class="go">     A=  2. B=  3.</span>
<span class="go"> INCREMENT A AND B</span>
<span class="go"> NEW A=  3. B=  4.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># these are integer rank-0 arrays</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scalar</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="go">     A=  2. B=  3.</span>
<span class="go"> INCREMENT A AND B</span>
<span class="go"> NEW A=  3. B=  4.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>          <span class="c1"># note that only b is changed in situ</span>
<span class="go">2 4</span>
</pre></div>
</div>
</section>
<section id="string-arguments">
<h2>String arguments<a class="headerlink" href="#string-arguments" title="Link to this heading">#</a></h2>
<p>F2PY generated wrapper functions accept almost any Python object as a string
argument, since <code class="docutils literal notranslate"><span class="pre">str</span></code> is applied for non-string objects. Exceptions are NumPy
arrays that must have type code <code class="docutils literal notranslate"><span class="pre">'S1'</span></code> or <code class="docutils literal notranslate"><span class="pre">'b'</span></code> (corresponding to the
outdated <code class="docutils literal notranslate"><span class="pre">'c'</span></code> or <code class="docutils literal notranslate"><span class="pre">'1'</span></code> typecodes, respectively) when used as string
arguments. See <a class="reference internal" href="../reference/arrays.scalars.html#arrays-scalars"><span class="std std-ref">Scalars</span></a> for more information on these typecodes.</p>
<p>A string can have an arbitrary length when used as a string argument for an F2PY
generated wrapper function. If the length is greater than expected, the string
is truncated silently. If the length is smaller than expected, additional memory
is allocated and filled with <code class="docutils literal notranslate"><span class="pre">\0</span></code>.</p>
<p>Because Python strings are immutable, an <code class="docutils literal notranslate"><span class="pre">intent(inout)</span></code> argument expects an
array version of a string in order to have <em>in situ</em> changes be effective.</p>
<p>Consider the following Fortran 77 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="n">STRING</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
<span class="w">      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="mi">5</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>
<span class="w">      </span><span class="kt">CHARACTER</span><span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="n">D</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">c</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="n">d</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;A=&quot;</span><span class="p">,</span><span class="n">A</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B=&quot;</span><span class="p">,</span><span class="n">B</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;C=&quot;</span><span class="p">,</span><span class="n">C</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D=&quot;</span><span class="p">,</span><span class="n">D</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;CHANGE A,B,C,D&quot;</span>
<span class="w">      </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span>
<span class="w">      </span><span class="n">B</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;B&#39;</span>
<span class="w">      </span><span class="n">C</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C&#39;</span>
<span class="w">      </span><span class="n">D</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;D&#39;</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;A=&quot;</span><span class="p">,</span><span class="n">A</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;B=&quot;</span><span class="p">,</span><span class="n">B</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;C=&quot;</span><span class="p">,</span><span class="n">C</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;D=&quot;</span><span class="p">,</span><span class="n">D</span>
<span class="w">      </span><span class="k">END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="k">FILE </span><span class="n">STRING</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">mystring</span> <span class="pre">string.f</span></code>.</p>
<p>Python session:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mystring</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mystring</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">foo(a,b,c,d)</span>

<span class="go">Wrapper for ``foo``.</span>

<span class="go">Parameters</span>
<span class="go">----------</span>
<span class="go">a : input string(len=5)</span>
<span class="go">b : in/output rank-0 array(string(len=5),&#39;c&#39;)</span>
<span class="go">c : input string(len=-1)</span>
<span class="go">d : in/output rank-0 array(string(len=-1),&#39;c&#39;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;123</span><span class="se">\0\0</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;123</span><span class="se">\0\0</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mystring</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="go"> A=123</span>
<span class="go"> B=123</span>
<span class="go"> C=123</span>
<span class="go"> D=123</span>
<span class="go"> CHANGE A,B,C,D</span>
<span class="go"> A=A23</span>
<span class="go"> B=B23</span>
<span class="go"> C=C23</span>
<span class="go"> D=D23</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[()],</span> <span class="n">b</span><span class="p">[()],</span> <span class="n">c</span><span class="p">[()],</span> <span class="n">d</span><span class="p">[()]</span>
<span class="go">(b&#39;123&#39;, b&#39;B23&#39;, b&#39;123&#39;, b&#39;D2&#39;)</span>
</pre></div>
</div>
</section>
<section id="array-arguments">
<h2>Array arguments<a class="headerlink" href="#array-arguments" title="Link to this heading">#</a></h2>
<p>In general, array arguments for F2PY generated wrapper functions accept
arbitrary sequences that can be transformed to NumPy array objects. There are
two notable exceptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intent(inout)</span></code> array arguments must always be
<a class="reference internal" href="../glossary.html#term-contiguous"><span class="xref std std-term">proper-contiguous</span></a> and have a compatible <code class="docutils literal notranslate"><span class="pre">dtype</span></code>,
otherwise an exception is raised.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">intent(inplace)</span></code> array arguments  will be changed <em>in situ</em> if the argument
has a different type than expected (see the <code class="docutils literal notranslate"><span class="pre">intent(inplace)</span></code>
<a class="reference internal" href="signature-file.html#f2py-attributes"><span class="std std-ref">attribute</span></a> for more information).</p></li>
</ul>
<p>In general, if a NumPy array is <a class="reference internal" href="../glossary.html#term-contiguous"><span class="xref std std-term">proper-contiguous</span></a> and has
a proper type then it is directly passed to the wrapped Fortran/C function.
Otherwise, an element-wise copy of the input array is made and the copy, being
proper-contiguous and with proper type, is used as the array argument.</p>
<p>Usually there is no need to worry about how the arrays are stored in memory and
whether the wrapped functions, being either Fortran or C functions, assume one
or another storage order. F2PY automatically ensures that wrapped functions get
arguments with the proper storage order; the underlying algorithm is designed to
make copies of arrays only when absolutely necessary. However, when dealing with
very large multidimensional input arrays with sizes close to the size of the
physical memory in your computer, then care must be taken to ensure the usage of
proper-contiguous and proper type arguments.</p>
<p>To transform input arrays to column major storage order before passing
them to Fortran routines, use the function <a class="reference internal" href="../reference/generated/numpy.asfortranarray.html#numpy.asfortranarray" title="numpy.asfortranarray"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.asfortranarray</span></code></a>.</p>
<p>Consider the following Fortran 77 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="k">ARRAY</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
<span class="n">C</span>
<span class="n">C</span><span class="w">     </span><span class="n">INCREMENT</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">ROW</span><span class="w"> </span><span class="nb">AND </span><span class="n">DECREMENT</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">FIRST</span><span class="w"> </span><span class="n">COLUMN</span><span class="w"> </span><span class="n">OF</span><span class="w"> </span><span class="n">A</span>
<span class="n">C</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">J</span>
<span class="w">      </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">out</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span><span class="w"> </span><span class="n">a</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="kt">integer </span><span class="k">intent</span><span class="p">(</span><span class="n">hide</span><span class="p">),</span><span class="n">depend</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="nb">shape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">m</span><span class="o">=</span><span class="nb">shape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">      </span><span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span>
<span class="w">         </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">J</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="n">D0</span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      DO </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span>
<span class="w">         </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="n">D0</span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="k">FILE ARRAY</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">arr</span> <span class="pre">array.f</span> <span class="pre">-DF2PY_REPORT_ON_ARRAY_COPY=1</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">arr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">asfortranarray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">a = foo(a,[overwrite_a])</span>

<span class="go">Wrapper for ``foo``.</span>

<span class="go">Parameters</span>
<span class="go">----------</span>
<span class="go">a : input rank-2 array(&#39;d&#39;) with bounds (n,m)</span>

<span class="go">Other Parameters</span>
<span class="go">----------------</span>
<span class="go">overwrite_a : input int, optional</span>
<span class="go">    Default: 0</span>

<span class="go">Returns</span>
<span class="go">-------</span>
<span class="go">a : rank-2 array(&#39;d&#39;) with bounds (n,m)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">... </span>             <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="go">created an array from object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[[ 1.  3.  4.]</span>
<span class="go"> [ 3.  5.  6.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
<span class="go"># even if a is proper-contiguous and has proper type,</span>
<span class="go"># a copy is made forced by intent(copy) attribute</span>
<span class="go"># to preserve its original contents</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">copied an array: size=6, elsize=8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[[ 1.  3.  4.]</span>
<span class="go"> [ 3.  5.  6.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">[[ 1.  4.  5.]</span>
<span class="go"> [ 2.  5.  6.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">overwrite_a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># a is passed directly to Fortran</span>
<span class="gp">... </span>                                <span class="c1"># routine and its contents is discarded</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">[[ 1.  4.  5.]</span>
<span class="go"> [ 2.  5.  6.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">[[ 1.  4.  5.]</span>
<span class="go"> [ 2.  5.  6.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="ow">is</span> <span class="n">b</span>                          <span class="c1"># a and b are actually the same objects</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>       <span class="c1"># different rank arrays are allowed</span>
<span class="go">created an array from object</span>
<span class="go">[ 1.  1.  2.]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">([[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]]))</span>
<span class="go">created an array from object</span>
<span class="go">[[[ 1.]</span>
<span class="go">  [ 1.]</span>
<span class="go">  [ 2.]]]</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Creating arrays with column major data storage order:</span>
<span class="go"> ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">asfortranarray</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[[1 2 3]</span>
<span class="go"> [4 5 6]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="n">asfortranarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="ow">is</span> <span class="n">s</span>    <span class="c1"># an array with column major storage order </span>
<span class="go">               # is returned immediately</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note that arr.foo returns a column major data storage order array:</span>
<span class="go"> ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span> <span class="o">=</span> <span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span>
<span class="go">copied an array: size=6, elsize=8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s3</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span>
<span class="go">False</span>
</pre></div>
</div>
</section>
<section id="call-back-arguments">
<span id="id1"></span><h2>Call-back arguments<a class="headerlink" href="#call-back-arguments" title="Link to this heading">#</a></h2>
<p>F2PY supports calling Python functions from Fortran or C codes.</p>
<p>Consider the following Fortran 77 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="n">CALLBACK</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span><span class="p">(</span><span class="n">FUN</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
<span class="w">      </span><span class="k">EXTERNAL </span><span class="n">FUN</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">I</span>
<span class="w">      </span><span class="kt">REAL</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">FUN</span>
<span class="n">Cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="n">r</span>
<span class="w">      </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="n">D0</span>
<span class="w">      </span><span class="k">DO </span><span class="n">I</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span>
<span class="w">         </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FUN</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
<span class="w">      </span><span class="k">ENDDO</span>
<span class="k">      END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="k">FILE </span><span class="n">CALLBACK</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">callback</span> <span class="pre">callback.f</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">callback</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">r = foo(fun,[fun_extra_args])</span>

<span class="go">Wrapper for ``foo``.</span>

<span class="go">Parameters</span>
<span class="go">----------</span>
<span class="go">fun : call-back function</span>

<span class="go">Other Parameters</span>
<span class="go">----------------</span>
<span class="go">fun_extra_args : input tuple, optional</span>
<span class="go">    Default: ()</span>

<span class="go">Returns</span>
<span class="go">-------</span>
<span class="go">r : float</span>

<span class="go">Notes</span>
<span class="go">-----</span>
<span class="go">Call-back functions::</span>

<span class="go">  def fun(i): return r</span>
<span class="go">  Required arguments:</span>
<span class="go">    i : input int</span>
<span class="go">  Return objects:</span>
<span class="go">    r : float</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">*</span><span class="n">i</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">110.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">callback</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span>
<span class="go">11.0</span>
</pre></div>
</div>
<p>In the above example F2PY was able to guess accurately the signature
of the call-back function. However, sometimes F2PY cannot establish the
appropriate signature; in these cases the signature of the call-back
function must be explicitly defined in the signature file.</p>
<p>To facilitate this, signature files may contain special modules (the names of
these modules contain the special <code class="docutils literal notranslate"><span class="pre">__user__</span></code> sub-string) that define the
various signatures for call-back functions.  Callback arguments in routine
signatures have the <code class="docutils literal notranslate"><span class="pre">external</span></code> attribute (see also the <code class="docutils literal notranslate"><span class="pre">intent(callback)</span></code>
<a class="reference internal" href="signature-file.html#f2py-attributes"><span class="std std-ref">attribute</span></a>). To relate a callback argument with its
signature in a <code class="docutils literal notranslate"><span class="pre">__user__</span></code> module block, a <code class="docutils literal notranslate"><span class="pre">use</span></code> statement can be utilized as
illustrated below. The same signature for a callback argument can be referred to
in different routine signatures.</p>
<p>We use the same Fortran 77 code as in the previous example but now
we will pretend that F2PY was not able to guess the signatures of
call-back arguments correctly. First, we create an initial signature
file <code class="docutils literal notranslate"><span class="pre">callback2.pyf</span></code> using F2PY:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f2py</span> <span class="o">-</span><span class="n">m</span> <span class="n">callback2</span> <span class="o">-</span><span class="n">h</span> <span class="n">callback2</span><span class="o">.</span><span class="n">pyf</span> <span class="n">callback</span><span class="o">.</span><span class="n">f</span>
</pre></div>
</div>
<p>Then modify it as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!    -*- f90 -*-
python module __user__routines 
    interface
        function fun(i) result (r)
            integer :: i
            real*8 :: r
        end function fun
    end interface
end python module __user__routines

python module callback2
    interface
        subroutine foo(f,r)
            use __user__routines, f=&gt;fun
            external f
            real*8 intent(out) :: r
        end subroutine foo
    end interface 
end python module callback2
</pre></div>
</div>
<p>Finally, we build the extension module using
<code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">callback2.pyf</span> <span class="pre">callback.f</span></code>.</p>
<p>An example Python session for this snippet would be identical to the previous
example except that the argument names would differ.</p>
<p>Sometimes a Fortran package may require that users provide routines that the
package will use. F2PY can construct an interface to such routines so that
Python functions can be called from Fortran.</p>
<p>Consider the following Fortran 77 subroutine that takes an array as its input
and applies a function <code class="docutils literal notranslate"><span class="pre">func</span></code> to its elements.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">calculate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="n">func</span>
<span class="w">      </span><span class="k">external </span><span class="n">func</span>
<span class="n">c</span><span class="w">     </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">F2PY</span><span class="p">:</span>
<span class="n">cf2py</span><span class="w"> </span><span class="kt">real</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">y</span>
<span class="n">cf2py</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">c</span>
<span class="n">cf2py</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="n">out</span><span class="p">,</span><span class="n">copy</span><span class="p">)</span><span class="w"> </span><span class="n">x</span>
<span class="w">      </span><span class="kt">integer </span><span class="n">n</span><span class="p">,</span><span class="n">i</span>
<span class="w">      </span><span class="kt">real</span><span class="o">*</span><span class="mi">8</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">func</span>
<span class="w">      </span><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<span class="w">         </span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="w">      </span><span class="k">end do</span>
<span class="k">      end</span>
</pre></div>
</div>
<p>The Fortran code expects that the function <code class="docutils literal notranslate"><span class="pre">func</span></code> has been defined externally.
In order to use a Python function for <code class="docutils literal notranslate"><span class="pre">func</span></code>, it must have an attribute
<code class="docutils literal notranslate"><span class="pre">intent(callback)</span></code> and it must be specified before the <code class="docutils literal notranslate"><span class="pre">external</span></code> statement.</p>
<p>Finally, build an extension module using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">foo</span> <span class="pre">calculate.f</span></code></p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">foo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="go">array([  0.,   1.,   4.,   9.,  16.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">)</span>
<span class="go">array([  1.        ,   2.71828183,   7.3890561,  20.08553692,  54.59815003])</span>
</pre></div>
</div>
<p>The function is included as an argument to the python function call to the
Fortran subroutine even though it was <em>not</em> in the Fortran subroutine argument
list. The external keyword refers to the C function generated by f2py, not the
Python function itself. The python function is essentially being supplied to the
C function.</p>
<p>The callback function may also be explicitly set in the module. Then it is not
necessary to pass the function in the argument list to the Fortran function.
This may be desired if the Fortran function calling the Python callback function
is itself called by another Fortran function.</p>
<p>Consider the following Fortran 77 subroutine:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">      </span><span class="k">subroutine </span><span class="n">f1</span><span class="p">()</span>
<span class="w">         </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;in f1, calling f2 twice..&quot;</span>
<span class="w">         </span><span class="k">call </span><span class="n">f2</span><span class="p">()</span>
<span class="w">         </span><span class="k">call </span><span class="n">f2</span><span class="p">()</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end</span>
<span class="k">      </span>
<span class="k">      subroutine </span><span class="n">f2</span><span class="p">()</span>
<span class="n">cf2py</span><span class="w">    </span><span class="k">intent</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="n">hide</span><span class="p">)</span><span class="w"> </span><span class="n">fpy</span>
<span class="w">         </span><span class="k">external </span><span class="n">fpy</span>
<span class="w">         </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;in f2, calling f2py..&quot;</span>
<span class="w">         </span><span class="k">call </span><span class="n">fpy</span><span class="p">()</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">pfromf</span> <span class="pre">extcallback.f</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pfromf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pfromf</span><span class="o">.</span><span class="n">f2</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">pfromf.error</span>: <span class="n">Callback fpy not defined (as an argument or module pfromf attribute).</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;python f&quot;</span><span class="p">)</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pfromf</span><span class="o">.</span><span class="n">fpy</span> <span class="o">=</span> <span class="n">f</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pfromf</span><span class="o">.</span><span class="n">f2</span><span class="p">()</span>
<span class="go"> in f2, calling f2py..</span>
<span class="go">python f</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pfromf</span><span class="o">.</span><span class="n">f1</span><span class="p">()</span>
<span class="go"> in f1, calling f2 twice..</span>
<span class="go"> in f2, calling f2py..</span>
<span class="go">python f</span>
<span class="go"> in f2, calling f2py..</span>
<span class="go">python f</span>
<span class="gp">&gt;&gt;&gt; </span>
</pre></div>
</div>
<section id="resolving-arguments-to-call-back-functions">
<h3>Resolving arguments to call-back functions<a class="headerlink" href="#resolving-arguments-to-call-back-functions" title="Link to this heading">#</a></h3>
<p>F2PY generated interfaces are very flexible with respect to call-back arguments.  For each call-back argument an additional optional
argument <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;_extra_args</span></code> is introduced by F2PY. This argument can be used
to pass extra arguments to user provided call-back functions.</p>
<p>If a F2PY generated wrapper function expects the following call-back argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">a_n</span><span class="p">):</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">x_1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">x_k</span>
</pre></div>
</div>
<p>but the following Python function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gun</span><span class="p">(</span><span class="n">b_1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">b_m</span><span class="p">):</span>
   <span class="o">...</span>
   <span class="k">return</span> <span class="n">y_1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">y_l</span>
</pre></div>
</div>
<p>is provided by a user, and in addition,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fun_extra_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">e_1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">e_p</span><span class="p">)</span>
</pre></div>
</div>
<p>is used, then the following rules are applied when a Fortran or C function
evaluates the call-back argument <code class="docutils literal notranslate"><span class="pre">gun</span></code>:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">==</span> <span class="pre">0</span></code> then <code class="docutils literal notranslate"><span class="pre">gun(a_1,</span> <span class="pre">...,</span> <span class="pre">a_q)</span></code> is called, here
<code class="docutils literal notranslate"><span class="pre">q</span> <span class="pre">=</span> <span class="pre">min(m,</span> <span class="pre">n)</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">+</span> <span class="pre">p</span> <span class="pre">&lt;=</span> <span class="pre">m</span></code> then <code class="docutils literal notranslate"><span class="pre">gun(a_1,</span> <span class="pre">...,</span> <span class="pre">a_n,</span> <span class="pre">e_1,</span> <span class="pre">...,</span> <span class="pre">e_p)</span></code> is called.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&lt;=</span> <span class="pre">m</span> <span class="pre">&lt;</span> <span class="pre">n</span> <span class="pre">+</span> <span class="pre">p</span></code> then <code class="docutils literal notranslate"><span class="pre">gun(a_1,</span> <span class="pre">...,</span> <span class="pre">a_q,</span> <span class="pre">e_1,</span> <span class="pre">...,</span> <span class="pre">e_p)</span></code> is called,
and here <code class="docutils literal notranslate"><span class="pre">q=m-p</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">&gt;</span> <span class="pre">m</span></code> then <code class="docutils literal notranslate"><span class="pre">gun(e_1,</span> <span class="pre">...,</span> <span class="pre">e_m)</span></code> is called.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">+</span> <span class="pre">p</span></code> is less than the number of required arguments to <code class="docutils literal notranslate"><span class="pre">gun</span></code> then an
exception is raised.</p></li>
</ul>
<p>If the function <code class="docutils literal notranslate"><span class="pre">gun</span></code> may return any number of objects as a tuple; then the
following rules are applied:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">l</span></code>, then <code class="docutils literal notranslate"><span class="pre">y_{k</span> <span class="pre">+</span> <span class="pre">1},</span> <span class="pre">...,</span> <span class="pre">y_l</span></code> are ignored.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&gt;</span> <span class="pre">l</span></code>, then only <code class="docutils literal notranslate"><span class="pre">x_1,</span> <span class="pre">...,</span> <span class="pre">x_l</span></code> are set.</p></li>
</ul>
</section>
</section>
<section id="common-blocks">
<h2>Common blocks<a class="headerlink" href="#common-blocks" title="Link to this heading">#</a></h2>
<p>F2PY generates wrappers to <code class="docutils literal notranslate"><span class="pre">common</span></code> blocks defined in a routine signature
block. Common blocks are visible to all Fortran codes linked to the current
extension module, but not to other extension modules (this restriction is due to
the way Python imports shared libraries). In Python, the F2PY wrappers to
<code class="docutils literal notranslate"><span class="pre">common</span></code> blocks are <code class="docutils literal notranslate"><span class="pre">fortran</span></code> type objects that have (dynamic) attributes
related to the data members of the common blocks. When accessed, these
attributes return as NumPy array objects (multidimensional arrays are
Fortran-contiguous) which directly link to data members in common blocks. Data
members can be changed by direct assignment or by in-place changes to the
corresponding array objects.</p>
<p>Consider the following Fortran 77 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="w"> </span><span class="k">FILE</span><span class="p">:</span><span class="w"> </span><span class="k">COMMON</span><span class="p">.</span><span class="n">F</span>
<span class="w">      </span><span class="k">SUBROUTINE </span><span class="n">FOO</span>
<span class="w">      </span><span class="kt">INTEGER </span><span class="n">I</span><span class="p">,</span><span class="n">X</span>
<span class="w">      </span><span class="kt">REAL </span><span class="n">A</span>
<span class="w">      </span><span class="k">COMMON</span><span class="w"> </span><span class="o">/</span><span class="k">DATA</span><span class="o">/</span><span class="w"> </span><span class="n">I</span><span class="p">,</span><span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;I=&quot;</span><span class="p">,</span><span class="n">I</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;X=[&quot;</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="s2">&quot;]&quot;</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;A=[&quot;</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;]&quot;</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">A</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;]&quot;</span>
<span class="w">      </span><span class="k">PRINT</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;]&quot;</span>
<span class="w">      </span><span class="k">END</span>
<span class="n">C</span><span class="w"> </span><span class="k">END </span><span class="n">OF</span><span class="w"> </span><span class="k">COMMON</span><span class="p">.</span><span class="n">F</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">common</span> <span class="pre">common.f</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">common</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">i : &#39;i&#39;-scalar</span>
<span class="go">x : &#39;i&#39;-array(4)</span>
<span class="go">a : &#39;f&#39;-array(2,3)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> I=           5</span>
<span class="go"> X=[           0           2           0           0 ]</span>
<span class="go"> A=[</span>
<span class="go"> [   1.00000000     ,   2.00000000     ,   3.00000000     ]</span>
<span class="go"> [   4.00000000     ,   5.00000000     ,   6.00000000     ]</span>
<span class="go"> ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> I=           5</span>
<span class="go"> X=[           0           2           0           0 ]</span>
<span class="go"> A=[</span>
<span class="go"> [   1.00000000     ,   2.00000000     ,   3.00000000     ]</span>
<span class="go"> [   45.0000000     ,   45.0000000     ,   45.0000000     ]</span>
<span class="go"> ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">a</span>                 <span class="c1"># a is Fortran-contiguous</span>
<span class="go">array([[  1.,   2.,   3.],</span>
<span class="go">       [ 45.,  45.,  45.]], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">common</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="fortran-90-module-data">
<h2>Fortran 90 module data<a class="headerlink" href="#fortran-90-module-data" title="Link to this heading">#</a></h2>
<p>The F2PY interface to Fortran 90 module data is similar to the handling of
Fortran 77 common blocks.</p>
<p>Consider the following Fortran 90 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="nb">mod</span>
<span class="nb">  </span><span class="kt">integer </span><span class="n">i</span>
<span class="w">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="w">  </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:,:)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="k">contains</span>
<span class="k">  subroutine </span><span class="n">foo</span>
<span class="w">    </span><span class="kt">integer </span><span class="n">k</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;i=&quot;</span><span class="p">,</span><span class="n">i</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;x=[&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;]&quot;</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;a=[&quot;</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;]&quot;</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;[&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="s2">&quot;]&quot;</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;]&quot;</span>
<span class="w">    </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Setting a(1,2)=a(1,2)+3&quot;</span>
<span class="w">    </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span>
<span class="w">  </span><span class="k">end subroutine </span><span class="n">foo</span>
<span class="k">end module </span><span class="nb">mod</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">moddata</span> <span class="pre">moddata.f90</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">moddata</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">i : &#39;i&#39;-scalar</span>
<span class="go">x : &#39;i&#39;-array(4)</span>
<span class="go">a : &#39;f&#39;-array(2,3)</span>
<span class="go">b : &#39;f&#39;-array(-1,-1), not allocated</span>
<span class="go">foo()</span>

<span class="go">Wrapper for ``foo``.</span>



<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>                
<span class="go"> i=           5</span>
<span class="go"> x=[           1           2           0           0 ]</span>
<span class="go"> a=[</span>
<span class="go"> [   1.000000     ,   2.000000     ,   3.000000     ]</span>
<span class="go"> [   4.000000     ,   5.000000     ,   6.000000     ]</span>
<span class="go"> ]</span>
<span class="go"> Setting a(1,2)=a(1,2)+3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span>               <span class="c1"># a is Fortran-contiguous</span>
<span class="go">array([[ 1.,  5.,  3.],</span>
<span class="go">       [ 4.,  5.,  6.]], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">moddata</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="allocatable-arrays">
<h2>Allocatable arrays<a class="headerlink" href="#allocatable-arrays" title="Link to this heading">#</a></h2>
<p>F2PY has basic support for Fortran 90 module allocatable arrays.</p>
<p>Consider the following Fortran 90 code:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">module </span><span class="nb">mod</span>
<span class="nb">  </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:,:)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="k">contains</span>
<span class="k">  subroutine </span><span class="n">foo</span>
<span class="w">    </span><span class="kt">integer </span><span class="n">k</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">       print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b=[&quot;</span>
<span class="w">       </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">          </span><span class="k">print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="w">       </span><span class="k">enddo</span>
<span class="k">       print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;]&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="k">       print</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b is not allocated&quot;</span>
<span class="w">    </span><span class="k">endif</span>
<span class="k">  end subroutine </span><span class="n">foo</span>
<span class="k">end module </span><span class="nb">mod</span>
</pre></div>
</div>
<p>and wrap it using <code class="docutils literal notranslate"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">allocarr</span> <span class="pre">allocarr.f90</span></code>.</p>
<p>In Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">allocarr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="go">b : &#39;f&#39;-array(-1,-1), not allocated</span>
<span class="go">foo()</span>

<span class="go">Wrapper for ``foo``.</span>



<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>  
<span class="go"> b is not allocated</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>             <span class="c1"># allocate/initialize b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> b=[</span>
<span class="go">   1.000000       2.000000       3.000000    </span>
<span class="go">   4.000000       5.000000       6.000000    </span>
<span class="go"> ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span>                                      <span class="c1"># b is Fortran-contiguous</span>
<span class="go">array([[ 1.,  2.,  3.],</span>
<span class="go">       [ 4.,  5.,  6.]], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">f_contiguous</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>  <span class="c1"># reallocate/initialize b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> b=[</span>
<span class="go">   1.000000       2.000000       3.000000    </span>
<span class="go">   4.000000       5.000000       6.000000    </span>
<span class="go">   7.000000       8.000000       9.000000    </span>
<span class="go"> ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="kc">None</span>                               <span class="c1"># deallocate array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">allocarr</span><span class="o">.</span><span class="n">mod</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
<span class="go"> b is not allocated</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="signature-file.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Signature file</p>
      </div>
    </a>
    <a class="right-next"
       href="buildtools/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">F2PY and build systems</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fortran-type-objects">Fortran type objects</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scalar-arguments">Scalar arguments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-arguments">String arguments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#array-arguments">Array arguments</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#call-back-arguments">Call-back arguments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resolving-arguments-to-call-back-functions">Resolving arguments to call-back functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#common-blocks">Common blocks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fortran-90-module-data">Fortran 90 module data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#allocatable-arrays">Allocatable arrays</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2008-2024, NumPy Developers.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>